#!/bin/sh

OS=`uname -s`

case $OS in
    'Linux')
        if [ -e /usr/lib/libresolv.a ]; then
            STATIC_LIB=/usr/lib/libresolv.a
        else
            STATIC_LIB=/usr/lib/*/libresolv.a
        fi
        DEF="-DHAVE_ERRX"
    ;;
    'Darwin'|'NetBSD')
        DEF="-DHAVE_ARC4RANDOM -DHAVE_ERRX"
        LIB="-lresolv"
    ;;
    'OpenBSD')
        if [ ! -e /usr/local/lib/libbind/libbind.a ]; then
            echo "Please install libbind: sudo pkg_add libbind"
            exit 1
        fi
        DEF="-DHAVE_ERR"
        LIB="-L/usr/local/lib/libbind -Wl,-rpath=/usr/local/lib/libbind -lbind -I/usr/local/include/bind"
    ;;
    'SunOS')
        LIB="-lresolv"
    ;;
    *)
        echo "Guessing, adjust Makefile by hand ..."
        LIB="-lresolv"
    ;;

esac

if [ -e /dev/urandom ]; then
    DEF="${DEF} -DHAVE_URANDOM"
fi

cat<<EOF>Makefile
CC=cc
RM=rm
APP=sdt

STATIC_LIB=${STATIC_LIB}
DEF=${DEF}
LIB=${LIB}

all:
	\$(CC) \$(DEF) -g -Wall \$(LIB) -o \$(APP) \$(APP).c \$(APP)_dns.c \$(APP)_err.c \$(APP)_rand.c base32.c base64.c \$(STATIC_LIB)

clean:
	-@\$(RM) *.o \$(APP)
EOF

