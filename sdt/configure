#!/bin/sh

OS=`uname -s`

case $OS in
    'Linux')
        if [ -e /usr/lib/libresolv.a ]; then
            STATIC_LIB=/usr/lib/libresolv.a
        else
            STATIC_LIB=/usr/lib/*/libresolv.a
        fi
        DEF="-DHAVE_ERRX -DHAVE_URANDOM"
    ;;
    'Darwin'|'NetBSD')
        DEF="-DHAVE_ARC4RANDOM -DHAVE_ERR"
        LIB="-lresolv"
    ;;
    'SunOS')
        LIB="-lresolv"
    ;;
    *)
        echo "Guessing, adjust Makefile by hand ..."
        LIB="-lresolv"
    ;;

esac

cat<<EOF>Makefile
CC=cc
RM=rm
APP=sdt

STATIC_LIB=${STATIC_LIB}
DEF=${DEF}
LIB=${LIB}

all:
	\$(CC) \$(DEF) -g -Wall \$(LIB) -o \$(APP) \$(APP).c \$(APP)_dns.c \$(APP)_err.c \$(APP)_rand.c base32.c base64.c \$(STATIC_LIB)

clean:
	-@\$(RM) *.o \$(APP)
EOF

